<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">

<html><head><title>forth_core</title><link rel="stylesheet" type="text/css" href="../styles/main.css"><script language=JavaScript src="../javascript/main.js"></script><script language=JavaScript src="../javascript/searchdata.js"></script></head><body class="ContentPage" onLoad="NDOnLoad()"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version 1.4 -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->




<div id=Content><div class="CFile"><div class=CTopic id=MainTopic><h1 class=CTitle><a name="forth_core"></a>forth_core</h1><div class=CBody><p>myforth: My own forth system.</p><p>This file is a translation of jonesforth (<a href="http://www.annexia.org/_file/jonesforth.s.txt" class=LURL target=_top>http://www.annexia.org/_file/jonesforth.s.txt</a>) for being compiled with nasm.</p><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBorder><table border=0 cellspacing=0 cellpadding=0 class=STable><tr class="SMain"><td class=SEntry><a href="#forth_core" >forth_core</a></td><td class=SDescription>myforth: My own forth system.</td></tr><tr class="SGeneric SMarked"><td class=SEntry><a href="#Introduction" >Introduction</a></td><td class=SDescription>Forth is an extensible, powerfull concatenative language/environment. </td></tr><tr class="SGroup"><td class=SEntry><a href="#Variables" >Variables</a></td><td class=SDescription></td></tr><tr class="SVariable SIndent1 SMarked"><td class=SEntry><a href="#STATE_Is_the_interpreter_executing_code(0)or_compiling(non-zero)" >STATE       Is the interpreter executing code (0) or compiling (non-zero)?</a></td><td class=SDescription></td></tr><tr class="SVariable SIndent1"><td class=SEntry><a href="#HERE_Points_to_the_next_free_byte_of_memory" >HERE        Points to the next free byte of memory.</a></td><td class=SDescription></td></tr><tr class="SVariable SIndent1 SMarked"><td class=SEntry><a href="#S0_Stores_the_address_of_the_top_of_the_parameter_stack" >S0          Stores the address of the top of the parameter stack.</a></td><td class=SDescription></td></tr><tr class="SVariable SIndent1"><td class=SEntry><a href="#BASE_The_current_base_for_printing_and_reading_numbers" >BASE        The current base for printing and reading numbers.</a></td><td class=SDescription></td></tr><tr class="SGroup"><td class=SEntry><a href="#Constants" >Constants</a></td><td class=SDescription></td></tr><tr class="SConstant SIndent1 SMarked"><td class=SEntry><a href="#R0_The_address_of_the_top_of_the_return_stack" >R0          The address of the top of the return stack.</a></td><td class=SDescription></td></tr><tr class="SConstant SIndent1"><td class=SEntry><a href="#DOCOL_Pointer_to_DOCOL" >DOCOL       Pointer to DOCOL.</a></td><td class=SDescription></td></tr><tr class="SConstant SIndent1 SMarked"><td class=SEntry><a href="#F_IMMED_The_IMMEDIATE_flag's_actual_value" >F_IMMED     The IMMEDIATE flag&rsquo;s actual value.</a></td><td class=SDescription></td></tr><tr class="SConstant SIndent1"><td class=SEntry><a href="#F_HIDDEN_The_HIDDEN_flag's_actual_value" >F_HIDDEN    The HIDDEN flag&rsquo;s actual value.</a></td><td class=SDescription></td></tr><tr class="SConstant SIndent1 SMarked"><td class=SEntry><a href="#F_LENMASK_The_length_mask_in_the_flags/len_byte" >F_LENMASK   The length mask in the flags/<wbr>len byte.</a></td><td class=SDescription></td></tr><tr class="SGroup"><td class=SEntry><a href="#Functions" >Functions</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#DOCOL" >DOCOL</a></td><td class=SDescription>This is the core of the forth virtual machine. </td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#EXIT" >EXIT</a></td><td class=SDescription>EXIT is the last word of a forth word (a non-defcode word). </td></tr></table></div></div><!--END_ND_SUMMARY--></div></div></div>

<div class="CGeneric"><div class=CTopic><h3 class=CTitle><a name="Introduction"></a>Introduction</h3><div class=CBody><p>Forth is an extensible, powerfull concatenative language/environment.&nbsp; This file contains the core routines needed for a minimal functional forth environment.</p><p>Forth code is based in &lsquo;words&rsquo;.&nbsp; A word can be implemented in assembly or using exclusively predefined words.&nbsp; We will call the formers defcode words and the laters defword words.</p><p>This is the word structure in this implementation</p><blockquote><pre>+---------------+
|     LINK      |  Link to the previous word
+---------------+
|  FLAGS + LEN  |  Several flags + length of the word name
+---------------+
|     NAME      |  Word name (4 bytes aligned)
+---------------+
|   CODEWORD    |  Pointer to the routine that executes this word
+---------------+
|     BODY      |  Optionally, if this is a defword, a serie of
+---------------+    pointers to the codewors of each word that
|     ...       |    define the current word.
+---------------+</pre></blockquote><p>The next word to be executed is pointed by the esi register.&nbsp; The NEXT macro is the responsable for its execution and the esi update.</p><p>If the word to be executed is a defcode, its implementation is in assembly.&nbsp; In this case, CODEWORD points directly to the assembly routine.&nbsp; The assembly routine must end with the NEXT macro, to execute the next word.</p><p>If the word to be executed is a defword, its codeword must point to DOCOL.&nbsp; DOCOL executes the word body.&nbsp; The word body is a serie of pointer to the codewords of each one of the words in this definition.&nbsp; DOCOL pushes on the <b>return stack</b> the address of the next word to execute and then executes one by one the words on the current word body.&nbsp; The word body must end with the EXIT word to restore the address of the next word to execute.</p></div></div></div>

<div class="CGroup"><div class=CTopic><h3 class=CTitle><a name="Variables"></a>Variables</h3></div></div>

<div class="CVariable"><div class=CTopic><h3 class=CTitle><a name="STATE_Is_the_interpreter_executing_code(0)or_compiling(non-zero)"></a>STATE       Is the interpreter executing code (0) or compiling (non-zero)?</h3></div></div>

<div class="CVariable"><div class=CTopic><h3 class=CTitle><a name="HERE_Points_to_the_next_free_byte_of_memory"></a>HERE        Points to the next free byte of memory.</h3></div></div>

<div class="CVariable"><div class=CTopic><h3 class=CTitle><a name="S0_Stores_the_address_of_the_top_of_the_parameter_stack"></a>S0          Stores the address of the top of the parameter stack.</h3></div></div>

<div class="CVariable"><div class=CTopic><h3 class=CTitle><a name="BASE_The_current_base_for_printing_and_reading_numbers"></a>BASE        The current base for printing and reading numbers.</h3></div></div>

<div class="CGroup"><div class=CTopic><h3 class=CTitle><a name="Constants"></a>Constants</h3></div></div>

<div class="CConstant"><div class=CTopic><h3 class=CTitle><a name="R0_The_address_of_the_top_of_the_return_stack"></a>R0          The address of the top of the return stack.</h3></div></div>

<div class="CConstant"><div class=CTopic><h3 class=CTitle><a name="DOCOL_Pointer_to_DOCOL"></a>DOCOL       Pointer to DOCOL.</h3></div></div>

<div class="CConstant"><div class=CTopic><h3 class=CTitle><a name="F_IMMED_The_IMMEDIATE_flag's_actual_value"></a>F_IMMED     The IMMEDIATE flag&rsquo;s actual value.</h3></div></div>

<div class="CConstant"><div class=CTopic><h3 class=CTitle><a name="F_HIDDEN_The_HIDDEN_flag's_actual_value"></a>F_HIDDEN    The HIDDEN flag&rsquo;s actual value.</h3></div></div>

<div class="CConstant"><div class=CTopic><h3 class=CTitle><a name="F_LENMASK_The_length_mask_in_the_flags/len_byte"></a>F_LENMASK   The length mask in the flags/<wbr>len byte.</h3></div></div>

<div class="CGroup"><div class=CTopic><h3 class=CTitle><a name="Functions"></a>Functions</h3></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="DOCOL"></a>DOCOL</h3><div class=CBody><p>This is the core of the forth virtual machine.&nbsp; This routine executes the non-native words.&nbsp; A non-native word is formed by a serie of pointers to the codewords of other forth words.&nbsp; DOCOL executes each one of these codewords.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="EXIT"></a>EXIT</h3><div class=CBody><p>EXIT is the last word of a forth word (a non-defcode word).&nbsp; It restores the value of esi, stored in the return stack by DOCOL when this word started.</p></div></div></div>

</div><!--Content-->


<div id=Footer><a href="http://www.naturaldocs.org">Generated by Natural Docs</a></div><!--Footer-->


<div id=Menu><div class=MEntry><div class=MFile><a href="ext-s.html">ext</a></div></div><div class=MEntry><div class=MFile><a href="ext1-s.html">ext1</a></div></div><div class=MEntry><div class=MFile><a href="ext2-s.html">ext2</a></div></div><div class=MEntry><div class=MFile><a href="ext3-s.html">ext3</a></div></div><div class=MEntry><div class=MFile id=MSelected>forth_core</div></div><div class=MEntry><div class=MFile><a href="forth_macros-s.html">forth_macros</a></div></div><div class=MEntry><div class=MFile><a href="forth_words-s.html">forth_words</a></div></div><div class=MEntry><div class=MFile><a href="kernel-s.html">kernel</a></div></div><div class=MEntry><div class=MFile><a href="kernel_video-s.html">kernel_video</a></div></div><div class=MEntry><div class=MFile><a href="LICENSE-txt.html">License</a></div></div><div class=MEntry><div class=MFile><a href="rest-s.html">rest</a></div></div><div class=MEntry><div class=MFile><a href="boot-s.html">Starting point of OS</a></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent1')">Index</a><div class=MGroupContent id=MGroupContent1><div class=MEntry><div class=MIndex><a href="../index/General.html">Everything</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Constants.html">Constants</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Files.html">Files</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Functions.html">Functions</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Macros.html">Macros</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Variables.html">Variables</a></div></div></div></div></div><script type="text/javascript"><!--
var searchPanel = new SearchPanel("searchPanel", "HTML", "../search");
--></script><div id=MSearchPanel class=MSearchPanelInactive><input type=text id=MSearchField value=Search onFocus="searchPanel.OnSearchFieldFocus(true)" onBlur="searchPanel.OnSearchFieldFocus(false)" onKeyUp="searchPanel.OnSearchFieldChange()"><select id=MSearchType onFocus="searchPanel.OnSearchTypeFocus(true)" onBlur="searchPanel.OnSearchTypeFocus(false)" onChange="searchPanel.OnSearchTypeChange()"><option  id=MSearchEverything selected value="General">Everything</option><option value="Constants">Constants</option><option value="Files">Files</option><option value="Functions">Functions</option><option value="Macros">Macros</option><option value="Variables">Variables</option></select></div></div><!--Menu-->



<!--START_ND_TOOLTIPS-->
<!--END_ND_TOOLTIPS-->




<div id=MSearchResultsWindow><iframe src="" frameborder=0 name=MSearchResults id=MSearchResults></iframe><a href="javascript:searchPanel.CloseResultsWindow()" id=MSearchResultsWindowClose>Close</a></div>


<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>